#! /usr/bin/bash
ARENA_WS_DIR="$(pwd)"
ARENA_ROS_DISTRO=${ARENA_ROS_DISTRO:-humble}

export FASTRTPS_DEFAULT_PROFILES_FILE=~/.ros/fastdds.xml
export ROS_DOMAIN_ID=1
export RMW_IMPLEMENTATION=rmw_fastrtps_cpp
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/ros/humble/lib/

source $(cd src/arena/arena-rosnav && poetry env info -p)/bin/activate
colcon build \
    --symlink-install \
    --continue-on-error \
    --packages-skip-build-finished \
    --packages-skip qt_gui_core rqt qt_gui_cpp rqt_gui_cpp python_orocos_kdl_vendor \
    --cmake-args -DPython3_ROOT_DIR=$(cd src/arena/arena-rosnav && poetry env info -p) -DBUILD_TESTING=OFF \
    $@

cd $ARENA_WS_DIR
if [ -f "/opt/ros/${ARENA_ROS_DISTRO}/setup.bash" ] ; then
    . "/opt/ros/${ARENA_ROS_DISTRO}/setup.bash"
fi
source install/local_setup.bash

if [ -f src/arena/arena-rosnav/isaac_setup.bash ] ; then
    . src/arena/arena-rosnav/isaac_setup.bash
fi