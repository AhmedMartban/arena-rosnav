#! /usr/bin/bash

export BUILD_EXCLUDES=""

ARENA_WS_DIR="$(pwd)"
ARENA_ROS_DISTRO=${ARENA_ROS_DISTRO:-humble}

source $(cd src/arena/arena-rosnav && poetry env info -p)/bin/activate
colcon build \
    --symlink-install \
    --continue-on-error \
    --packages-skip-build-finished \
    --packages-skip qt_gui_core rqt qt_gui_cpp rqt_gui_cpp python_orocos_kdl_vendor \
    --cmake-args -DPython3_ROOT_DIR=$(cd src/arena/arena-rosnav && poetry env info -p) -DBUILD_TESTING=OFF \
    $@

cd $ARENA_WS_DIR
if [ -f "/opt/ros/${ARENA_ROS_DISTRO}/setup.bash" ] ; then
    . "/opt/ros/${ARENA_ROS_DISTRO}/setup.bash"
fi
source install/local_setup.bash